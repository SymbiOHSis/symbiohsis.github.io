<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.1.0/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.1.0/leaflet.js"></script>
</head>

<body>
    <h1>My First Heading</h1>
    <div id="map" style="height: 50vh; width: 50vw; position: absolute; top: 10vh; left: 10vw;"></div>
    <script>
        var country = "New Zealand",
            countryCode = "nz",
            city = "Auckland";

        $.getJSON(`http://nominatim.openstreetmap.org/search/?format=jsonv2&city=${city}`, function(osm_city) {
            osm_city = osm_city[0];
            var map = L.map('map').setView([osm_city.lat, osm_city.lon], 10);

            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            $.getJSON(`http://api.vexdb.io/v1/get_teams?country=${country}&city=${city}`, function(vexdb) {
                requestedOrganisations = [];
                $.each(vexdb.result, function() {
                    var team = this;
                    if (requestedOrganisations.indexOf(team.organisation) != -1)
                        return;
                    requestedOrganisations.push(team.organisation);
                    $.getJSON(`http://nominatim.openstreetmap.org/search/${team.organisation}?format=jsonv2&addressdetails=1&countrycodes=${countryCode}`, function(osm) {
                        osm = osm[0];
                        if (!osm)
                            return;
                        L.marker([osm.lat, osm.lon]).addTo(map).bindPopup(team.organisation)
                    });
                });
            });
        });
    </script>
</body>

</html>
